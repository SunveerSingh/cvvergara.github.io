<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Введение в PostGIS &mdash; OSGeo-Live 11.0beta
 Documentation</title>
    
    <link rel="stylesheet" href="../../_static/overview.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '11.0beta
',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="OSGeo-Live 11.0beta
 Documentation" href="../../index.html" /> 
	<script type="text/javascript" src="../../_static/osgeolive.js"></script>

  </head>
  <body role="document">
    <div class="header">
	<div class="banner"><a href="http://live.osgeo.org/"><img src="../../_images/banner.png"></a></div>
        <div class="nowrap">
            <ul id="top-nav">
              <li><a href="../index.html">Home</a></li>
              <li><a href="../overview/overview.html">Contents</a></li>
              <!--li><a href="../standards/standards.html">Standards</a></li-->
              <li><a href="../download.html">Download</a></li>
              <li><a href="../metrics.html">Metrics</a></li>
              <li><a href="../sponsors.html">Sponsors</a></li>
              <li><a href="../contact.html">Contact Us</a></li>
            </ul>
        </div>
    </div>

    <div class="related">
	<font size="-2">
		<div id="translations">
		<!--
			<a href="../../en/index.html">English</a> |
			<a href="../../es/index.html">Español</a> |
			<a href="../../ca/index.html">Català</a> |
			<a href="../../fr/index.html">Français</a> |
			<a href="../../de/index.html">Deutsch</a> |
			<a href="../../it/index.html">Italiano</a> |
			<a href="../../pl/index.html">Polski</a> |
			<a href="../../el/index.html">Ελληνικά</a> |
			<a href="../../ru/index.html">Русский</a> |
			<a href="../../zh/index.html">中文</a> |
			<a href="../../id/index.html">Bahasa Indonesia</a> |
			<a href="../../ko/index.html">한국어</a> |
			<a href="../../ja/index.html">日本語</a>
		-->
		<!-- geo-order: West to East, UK to Japan -->
			<a href="javascript:defaultRedirect('en')">English</a> |
<!--			<a href="javascript:defaultRedirect('pt')">Portugus</a> | -->
			<a href="javascript:defaultRedirect('es')">Español</a> |
			<a href="javascript:defaultRedirect('ca')">Català</a> |
			<a href="javascript:defaultRedirect('fr')">Français</a> |
			<a href="javascript:defaultRedirect('de')">Deutsch</a> |
			<a href="javascript:defaultRedirect('it')">Italiano</a> |
			<a href="javascript:defaultRedirect('pl')">Polski</a> |
			<a href="javascript:defaultRedirect('el')">Ελληνικά</a> |
			<a href="javascript:defaultRedirect('ru')">Русский</a> |
			<a href="javascript:defaultRedirect('zh')">中文</a> |
<!--			<a href="javascript:defaultRedirect('id')">Bahasa Indonesia</a> | -->
			<a href="javascript:defaultRedirect('ko')">한국어</a> |
			<a href="javascript:defaultRedirect('ja')">日本語</a>
		</div>
	</font>
    </div>


    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <a class="reference external image-reference" href="http://postgis.net"><img alt="project logo" class="align-right" src="../../_images/logo-PostGIS.png" style="width: 26.1px; height: 38.4px;" /></a>
<a class="reference external image-reference" href="http://www.osgeo.org"><img alt="OSGeo Project" class="align-right" src="../../_images/OSGeo_project.png" style="width: 150.0px; height: 53.0px;" /></a>
<div class="section" id="postgis">
<h1><a class="toc-backref" href="#id10">Введение в PostGIS</a><a class="headerlink" href="#postgis" title="Permalink to this headline">¶</a></h1>
<p>PostGIS добавляет дополнительную функциональность к СУБД PostgreSQL. PostGIS расширяет возможности
PostgreSQL с точки зрения хранения пространственных данных, запросов к ним и управления ими. В данном
&#8220;введении&#8221; будут описаны основные функции PostgreSQL и PostGIS.</p>
<p>Данное «введение» описывает:</p>
<blockquote>
<div><ul class="simple">
<li>Как создать пространственную базу данных и делать запросы к ней из командной
строки и из <a class="reference internal" href="../overview/qgis_overview.html"><span class="doc">Quantum GIS</span></a>.</li>
<li>Управлять данными из клиента <code class="docutils literal"><span class="pre">pgAdmin</span></code>.</li>
</ul>
</div></blockquote>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#postgis" id="id10">Введение в PostGIS</a><ul>
<li><a class="reference internal" href="#id1" id="id11">Архитектура Клиент-Сервер</a></li>
<li><a class="reference internal" href="#id2" id="id12">Создание баз данных, поддерживающих пространственную информацию</a></li>
<li><a class="reference internal" href="#id3" id="id13">Создание пространственной таблицы сложным способом</a></li>
<li><a class="reference internal" href="#id4" id="id14">Простые запросы</a></li>
<li><a class="reference internal" href="#id5" id="id15">Пространственные запросы</a></li>
<li><a class="reference internal" href="#id6" id="id16">Картирование</a></li>
<li><a class="reference internal" href="#id7" id="id17">Простое создание пространственной таблицы</a></li>
<li><a class="reference internal" href="#pgadmin-iii" id="id18">Знакомство с pgAdmin III</a></li>
<li><a class="reference internal" href="#sql-pgadmin-iii" id="id19">Выполнение SQL-запроса из pgAdmin III</a></li>
<li><a class="reference internal" href="#id8" id="id20">Что стоит попробовать</a></li>
<li><a class="reference internal" href="#id9" id="id21">Что дальше?</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id11">Архитектура Клиент-Сервер</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>PostgreSQL, как и другие СУБД, работает в качестве сервера в системе клиент-сервер.
Клиент отправляет серверу запрос и получает отклик. По такому же принципу работает сеть Интернет:
ваш браузер является клиентом, посылающим запрос, а веб-сервер возвращает обратно веб-страницу.
Запросы PostgreSQL производятся с помощью языка SQL, откликами обычно являются таблицы данных из базы данных.</p>
<p>Ничего не мешает серверу PostgreSQL находится на одном компьютере с клиентом.
Ваш клиент подключается к серверу по внутреннему IP-интерфейсу обратной связи, который не виден для других компьютеров (если вы не настроите иначе).</p>
<p>Здесь будут показаны три клиента: клиент командной строки, <a class="reference internal" href="../overview/qgis_overview.html"><span class="doc">Quantum GIS</span></a>
и графический клиент базы данных&nbsp;— <code class="docutils literal"><span class="pre">pgAdmin</span></code>.</p>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id12">Создание баз данных, поддерживающих пространственную информацию</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Клиенты командной строки запускаются из окна эмулятора терминала. Запустите эмулятор терминала из меню <em>Приложения</em> в разделе <em>Дополнительное</em>.
Это даст вам доступ к оболочке командной строки. Напечатайте:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">psql</span> <span class="o">-</span><span class="n">V</span>
</pre></div>
</div>
<p>нажмите Ввод, чтобы увидеть версию PostgreSQL.</p>
<p>Один сервер PostgreSQL позволяет организовать работу, распределив её по отдельным базам данных.
Каждая из баз данных будет работать в своем режиме, со своими собственными таблицами, видами, пользователями, и т.п.
При установлении соединения к серверу PostgreSQL вы должны указать нужную базу данных.</p>
<p>Чтобы получить список баз данных, хранящихся на сервере, напечатайте команду:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">psql</span> <span class="o">-</span><span class="n">l</span>
</pre></div>
</div>
<p>Вы увидите несколько баз данных, используемых несколькими проектами системы.
В этом введении будет создана новая база данных.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Список использует стандартный Unix-pager: нажмите пробел, чтобы перейти на следующую страницу, <code class="kbd docutils literal"><span class="pre">b</span></code>, чтобы вернуться, <code class="kbd docutils literal"><span class="pre">q</span></code>
для выхода и <code class="kbd docutils literal"><span class="pre">b</span></code> для вызова справки.</p>
</div>
<p>PostgreSQL предоставляет служебную программу для создания базы данных <code class="docutils literal"><span class="pre">createdb</span></code>.
Мы создадим базу данных с помощью расширения PostGIS, указав используемый шаблон.
Назовите базу данных <code class="docutils literal"><span class="pre">demo</span></code>. У этом случае команда будет выглядеть следующим образом:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">createdb</span> <span class="o">-</span><span class="n">T</span> <span class="n">template_postgis</span> <span class="n">demo</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Вы можете получить справку в командой строке, использую опцию <code class="docutils literal"><span class="pre">--help</span></code>.</p>
</div>
<p>Если вы запустите команду <code class="docutils literal"><span class="pre">psql</span> <span class="pre">-l</span></code>, то должны увидеть базу <code class="docutils literal"><span class="pre">demo</span></code> в списке баз данных.</p>
<p>Вы можете создать базу данных PostGIS с помощью языка SQL. Сначала мы удалим только что созданную базу данных с помощью команды
<code class="docutils literal"><span class="pre">dropdb</span></code>, потом используем команду <code class="docutils literal"><span class="pre">psql</span></code>, чтобы получить интерпретатор команд SQL:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dropdb</span> <span class="n">demo</span>
<span class="n">psql</span> <span class="o">-</span><span class="n">d</span> <span class="n">postgres</span>
</pre></div>
</div>
<p>Эти команды подключат к системной базе данных <code class="docutils literal"><span class="pre">postgres</span></code>, которую должны иметь все сервера.
Введите запрос SQL, чтобы создать новую базу данных:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">postgres</span><span class="o">=</span><span class="c1"># CREATE DATABASE demo TEMPLATE=template_postgis;</span>
</pre></div>
</div>
<p>Переключите ваше соединение с базы данных <code class="docutils literal"><span class="pre">postgres</span></code> на новую базу данных <code class="docutils literal"><span class="pre">demo</span></code>.
В дальнейшем вы сможете подключаться непосредственно к базе данных, используя команду <code class="docutils literal"><span class="pre">psql</span> <span class="pre">-d</span> <span class="pre">demo</span></code>. Тут показан способ переключения с помощью <code class="docutils literal"><span class="pre">psql</span></code> в командной строке:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">postgres</span><span class="o">=</span><span class="c1"># \c demo</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Нажмите <code class="kbd docutils literal"><span class="pre">CTRL</span></code> + <code class="kbd docutils literal"><span class="pre">C</span></code>, если подсказка <em>psql</em> появляется после нажатия кнопки возврата.
Это приведет к очищению введённой информации. Возможно, вам понадобится закрыть кавычки, двоеточие и тп.</p>
</div>
<p>Вы должны увидеть информационное сообщение, в котором будет указано, что
вы подключены к базе данных <code class="docutils literal"><span class="pre">demo</span></code>.</p>
<p>Далее, добавим PostGIS 2.0:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># create extension postgis;</span>
</pre></div>
</div>
<p>Чтобы проверить, что всё работает, напечатайте
<code class="docutils literal"><span class="pre">\dt</span></code> , эта команда отобразит список таблиц в базе данных.
Вы должны увидеть подобный этому список:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># \dt</span>
             <span class="n">List</span> <span class="n">of</span> <span class="n">relations</span>
 <span class="n">Schema</span> <span class="o">|</span>       <span class="n">Name</span>       <span class="o">|</span> <span class="n">Type</span>  <span class="o">|</span> <span class="n">Owner</span>
<span class="o">--------+------------------+-------+-------</span>
 <span class="n">public</span> <span class="o">|</span> <span class="n">spatial_ref_sys</span>  <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">user</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>Это таблица, используемая PostGIS. Таблица <code class="docutils literal"><span class="pre">spatial_ref_sys</span></code> хранит информацию о системе координат, чтобы быстро просмотреть информацию,
используйте команду SQL:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT srid,auth_name,proj4text FROM spatial_ref_sys LIMIT 10;</span>

 <span class="n">srid</span> <span class="o">|</span> <span class="n">auth_name</span> <span class="o">|</span>          <span class="n">proj4text</span>
<span class="o">------+-----------+--------------------------------------</span>
 <span class="mi">3819</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">bessel</span> <span class="o">+</span><span class="n">towgs</span><span class="o">...</span>
 <span class="mi">3821</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">aust_SA</span> <span class="o">+</span><span class="n">no_d</span><span class="o">...</span>
 <span class="mi">3824</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">GRS80</span> <span class="o">+</span><span class="n">towgs8</span><span class="o">...</span>
 <span class="mi">3889</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">GRS80</span> <span class="o">+</span><span class="n">towgs8</span><span class="o">...</span>
 <span class="mi">3906</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">bessel</span> <span class="o">+</span><span class="n">no_de</span><span class="o">...</span>
 <span class="mi">4001</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">airy</span> <span class="o">+</span><span class="n">no_defs</span><span class="o">...</span>
 <span class="mi">4002</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">a</span><span class="o">=</span><span class="mf">6377340.189</span> <span class="o">+</span><span class="n">b</span><span class="o">=</span><span class="mf">63.</span><span class="o">..</span>
 <span class="mi">4003</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">aust_SA</span> <span class="o">+</span><span class="n">no_d</span><span class="o">...</span>
 <span class="mi">4004</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">bessel</span> <span class="o">+</span><span class="n">no_de</span><span class="o">...</span>
 <span class="mi">4005</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">a</span><span class="o">=</span><span class="mf">6377492.018</span> <span class="o">+</span><span class="n">b</span><span class="o">=</span><span class="mf">63.</span><span class="o">..</span>
<span class="p">(</span><span class="mi">10</span> <span class="n">строк</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Выведенные таблицы подтверждают, что наша база пространственная. Таблица</dt>
<dd><code class="docutils literal"><span class="pre">geometry_columns</span></code> служит для передачи информации о том, какая из таблиц содержит пространсвенную информацию.</dd>
</dl>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id13">Создание пространственной таблицы сложным способом</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Теперь, имея пространственную базу данных, можно создать несколько пространственных таблиц.
Сначала мы создадим обычную таблицу базы данных, чтобы хранить данные о городе. Эта таблица
будет содержвать два поля&nbsp;— одно числовое поле-идентификатор, второе&nbsp;— название города:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># CREATE TABLE cities ( id int4 primary key, name varchar(50), the_geom geometry(POINT,4326) );</span>
</pre></div>
</div>
<p>Далее добавьте колонку геометрии, содержащую данные о местоположении
городов. Для удобства назовем это поле <code class="docutils literal"><span class="pre">geom</span></code> (более ранние версии PostGIS
требуют имени таблицы <code class="docutils literal"><span class="pre">the_geom</span></code>). Это поле указывает PostGIS, какой тип
геометрии имеет каждый из объектов (точки, линии, полигоны и т.п.), какая
размерность (т.к. возможны и 3-4 измерения — POINTZ, POINTM, POINTZM) и какая
система координат. Для данных по городам мы будем использовать систему координат
EPSG:4326.</p>
<blockquote>
<div>Заглянув в таблицу города, вы увидите новую колонку, а также информацию о том,
что в таблице отсутствуют строки.</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT * from cities;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">name</span> <span class="o">|</span> <span class="n">the_geom</span>
<span class="o">----+------+----------</span>
<span class="p">(</span><span class="mi">0</span> <span class="n">строк</span><span class="p">)</span>
</pre></div>
</div>
<p>Чтобы добавить строки в таблицу, используйте команды SQL. Чтобы добавить данные
геометрии в соответствующую колонку, используйте функцию PostGIS
<code class="docutils literal"><span class="pre">ST_GeomFromText</span></code>, чтобы сконвертировать координаты и идентификатор
референсной системы из текстового формата:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># INSERT INTO cities (id, the_geom, name) VALUES (1,ST_GeomFromText(&#39;POINT(-0.1257 51.508)&#39;,4326),&#39;London, England&#39;);</span>
<span class="n">demo</span><span class="o">=</span><span class="c1"># INSERT INTO cities (id, the_geom, name) VALUES (2,ST_GeomFromText(&#39;POINT(-81.233 42.983)&#39;,4326),&#39;London, Ontario&#39;);</span>
<span class="n">demo</span><span class="o">=</span><span class="c1"># INSERT INTO cities (id, the_geom, name) VALUES (3,ST_GeomFromText(&#39;POINT(27.91162491 -33.01529)&#39;,4326),&#39;East London,SA&#39;);</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Используйте кнопки-стрелки для отмены и редактирования командной строки.</p>
</div>
<p>Как вы могли заметить, это быстро надоедает. К счастью, существуют иные, более
лёгкие пути передачи данных в таблицы PostGIS. Сейчас в нашей базе находятся три
города, с которыми мы можем начать работать.</p>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id14">Простые запросы</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Все самые обычные операторы SQL могут быть использованы для выбора данных из таблицы PostGIS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT * FROM cities;</span>
 <span class="nb">id</span> <span class="o">|</span>      <span class="n">name</span>       <span class="o">|</span>                      <span class="n">the_geom</span>
<span class="o">----+-----------------+----------------------------------------------------</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">England</span> <span class="o">|</span> <span class="mf">0101000020E6100000</span><span class="n">BBB88D06F016C0BF1B2FDD2406C14940</span>
  <span class="mi">2</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Ontario</span> <span class="o">|</span> <span class="mf">0101000020E6100000</span><span class="n">F4FDD478E94E54C0E7FBA9F1D27D4540</span>
  <span class="mi">3</span> <span class="o">|</span> <span class="n">East</span> <span class="n">London</span><span class="p">,</span><span class="n">SA</span>  <span class="o">|</span> <span class="mf">0101000020E610000040</span><span class="n">AB064060E93B4059FAD005F58140C0</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">строки</span><span class="p">)</span>
</pre></div>
</div>
<p>Это возвращает нам бессмысленные значения координат в шестнадцатеричной системе.
Если вы хотите увидеть вашу геометрию в текстовом формате WKT, используйте функцию ST_AsText(the_geom) или ST_AsEwkt(the_geom).
Вы также можете использовать функции ST_X(the_geom), ST_Y(the_geom), чтобы получить числовые значения координат.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT id, ST_AsText(the_geom), ST_AsEwkt(the_geom), ST_X(the_geom), ST_Y(the_geom) FROM cities;</span>
 <span class="nb">id</span> <span class="o">|</span>          <span class="n">st_astext</span>           <span class="o">|</span>               <span class="n">st_asewkt</span>                <span class="o">|</span>    <span class="n">st_x</span>     <span class="o">|</span>   <span class="n">st_y</span>
<span class="o">----+------------------------------+----------------------------------------+-------------+-----------</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1257</span> <span class="mf">51.508</span><span class="p">)</span>        <span class="o">|</span> <span class="n">SRID</span><span class="o">=</span><span class="mi">4326</span><span class="p">;</span><span class="n">POINT</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1257</span> <span class="mf">51.508</span><span class="p">)</span>        <span class="o">|</span>     <span class="o">-</span><span class="mf">0.1257</span> <span class="o">|</span>    <span class="mf">51.508</span>
  <span class="mi">2</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="o">-</span><span class="mf">81.233</span> <span class="mf">42.983</span><span class="p">)</span>        <span class="o">|</span> <span class="n">SRID</span><span class="o">=</span><span class="mi">4326</span><span class="p">;</span><span class="n">POINT</span><span class="p">(</span><span class="o">-</span><span class="mf">81.233</span> <span class="mf">42.983</span><span class="p">)</span>        <span class="o">|</span>     <span class="o">-</span><span class="mf">81.233</span> <span class="o">|</span>    <span class="mf">42.983</span>
  <span class="mi">3</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="mf">27.91162491</span> <span class="o">-</span><span class="mf">33.01529</span><span class="p">)</span> <span class="o">|</span> <span class="n">SRID</span><span class="o">=</span><span class="mi">4326</span><span class="p">;</span><span class="n">POINT</span><span class="p">(</span><span class="mf">27.91162491</span> <span class="o">-</span><span class="mf">33.01529</span><span class="p">)</span> <span class="o">|</span> <span class="mf">27.91162491</span> <span class="o">|</span> <span class="o">-</span><span class="mf">33.01529</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">строки</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id15">Пространственные запросы</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Мы уже увидели, как получить геометрию из текстовых данных WKT с помощью функции ST_GeomFromText.
Большинство таких функций начинаются с ST (&#8220;пространственный тип&#8221;) и описаны в документации PostGIS.
Мы используем одну из них, чтобы ответить на практический вопрос: на каком расстоянии в метрах
друг от другах находятся три города с названием Лондон, учитывая сферичность земли?</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT p1.name,p2.name,ST_Distance_Sphere(p1.the_geom,p2.the_geom) FROM cities AS p1, cities AS p2 WHERE p1.id &gt; p2.id;</span>
      <span class="n">name</span>       <span class="o">|</span>      <span class="n">name</span>       <span class="o">|</span> <span class="n">st_distance_sphere</span>
<span class="o">-----------------+-----------------+--------------------</span>
 <span class="n">London</span><span class="p">,</span> <span class="n">Ontario</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">England</span> <span class="o">|</span>   <span class="mf">5875766.85191657</span>
 <span class="n">East</span> <span class="n">London</span><span class="p">,</span><span class="n">SA</span>  <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">England</span> <span class="o">|</span>   <span class="mf">9789646.96784908</span>
 <span class="n">East</span> <span class="n">London</span><span class="p">,</span><span class="n">SA</span>  <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Ontario</span> <span class="o">|</span>   <span class="mf">13892160.9525778</span>
 <span class="p">(</span><span class="mi">3</span> <span class="n">строки</span><span class="p">)</span>
</pre></div>
</div>
<p>Этот запрос возвращает расстояние в метрах между каждой парой городов. Обратите внимание как часть &#8216;WHERE&#8217;
предотвращает нас от получения расстояния от города до самого себя (расстояние всегда будет равно нулю) и расстояния в обратном порядке
(расстояние от Лондона, Англия до Лондона, Онтарио  будет таким же как от Лондона, Онтарио до Лондона, Англия).
Попробуйте ещё раз без &#8216;WHERE&#8217; и посмотрите, что произойдёт.</p>
<p>Мы также можем рассчитать расстояния на сфере, используя различные функции и указывая называния сфероида,
параметры главных полуосей и коэффициента обратного сжатия:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT p1.name,p2.name,ST_Distance_Spheroid(</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">the_geom</span><span class="p">,</span><span class="n">p2</span><span class="o">.</span><span class="n">the_geom</span><span class="p">,</span> <span class="s1">&#39;SPHEROID[&quot;GRS_1980&quot;,6378137,298.257222]&#39;</span>
        <span class="p">)</span>
       <span class="n">FROM</span> <span class="n">cities</span> <span class="n">AS</span> <span class="n">p1</span><span class="p">,</span> <span class="n">cities</span> <span class="n">AS</span> <span class="n">p2</span> <span class="n">WHERE</span> <span class="n">p1</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="o">.</span><span class="n">id</span><span class="p">;</span>
      <span class="n">name</span>       <span class="o">|</span>      <span class="n">name</span>       <span class="o">|</span> <span class="n">st_distance_spheroid</span>
<span class="o">-----------------+-----------------+----------------------</span>
 <span class="n">London</span><span class="p">,</span> <span class="n">Ontario</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">England</span> <span class="o">|</span>     <span class="mf">5892413.63776489</span>
 <span class="n">East</span> <span class="n">London</span><span class="p">,</span><span class="n">SA</span>  <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">England</span> <span class="o">|</span>     <span class="mf">9756842.65711931</span>
 <span class="n">East</span> <span class="n">London</span><span class="p">,</span><span class="n">SA</span>  <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Ontario</span> <span class="o">|</span>     <span class="mf">13884149.4140698</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">строки</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id16">Картирование</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>Для создания карты из данных PostGIS вам необходим клиент, с помощью которого вы сможете интерпретировать данные.
Многие из открытых ГИС могут делать это, например, Quantum GIS, gvSIG, uDig.
Далее будет показано, как сделать карту с помощью Quantum GIS.</p>
<dl class="docutils">
<dt>Запустите Quantum GIS и выберите <code class="docutils literal"><span class="pre">Add</span> <span class="pre">PostGIS</span> <span class="pre">layers</span></code> из меню <em>Слой</em>.  Параметры для подключения к данным</dt>
<dd>Natural Earth в PostGIS уже определены в выпадающем меню <em>Соединения</em>. Там же вы можете создать новое подключение к серверу и хранить настройки для быстрого доступа. Нажмите <code class="docutils literal"><span class="pre">Edit</span></code>, если хотите увидеть, какие параметры указаны для данных Natural Earth,
или нажмите <code class="docutils literal"><span class="pre">Connect</span></code>, чтобы продолжить:</dd>
</dl>
<a class="reference internal image-reference" href="../../_images/postgis_addlayers.png"><img alt="Connect to Natural Earth" class="align-center" src="../../_images/postgis_addlayers.png" style="width: 300.0px; height: 252.0px;" /></a>
<p>Появится список пространственных таблиц базы данных:</p>
<a class="reference internal image-reference" href="../../_images/postgis_listtables.png"><img alt="Natural Earth Layers" class="align-center" src="../../_images/postgis_listtables.png" style="width: 300.0px; height: 252.0px;" /></a>
<p>Выберите озёра (&#8220;Lakes&#8221;) и нажмите <code class="docutils literal"><span class="pre">Add</span></code> внизу (не <code class="docutils literal"><span class="pre">Load</span></code> вверху, которая подгрузит параметры подключения базы данных),
после чего слой откроется в QGIS:</p>
<a class="reference internal image-reference" href="../../_images/postgis_lakesmap.png"><img alt="My First PostGIS layer" class="align-center" src="../../_images/postgis_lakesmap.png" style="width: 512.0px; height: 371.5px;" /></a>
<p>Вы должны увидеть карту с озёрами. QGIS не знает, что это озера, поэтому,
возможно, они будут не голубого цвета. Используйте документацию QGIS, чтобы
узнать, как изменить цвет. Увеличьте обзор до группы знаменитаых озёр Канады.</p>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id17">Простое создание пространственной таблицы</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>Большинство приложений OSGeo поддерживают импорт пространственных данных из файлов
в базу данных PostGIS. Для демонстрации этого будет использован QGIS.</p>
<p>Импорт шейп-файлов в PostGIS через QGIS можно сделать в с помощью дополнения <em>PostGIS Manager</em>.
Чтобы установить его, перейдите в меню <code class="docutils literal"><span class="pre">Модули</span></code>, далее <code class="docutils literal"><span class="pre">Загрузить</span> <span class="pre">модули</span></code>. QGIS загрузит самую
новую версию из репозитория (для этого вам потребуется работающее интернет-соединение).
Найдите <code class="docutils literal"><span class="pre">PostGIS</span> <span class="pre">Manager</span></code> и нажмите кнопку <code class="docutils literal"><span class="pre">Install</span> <span class="pre">plugin</span></code>.</p>
<a class="reference internal image-reference" href="../../_images/postgis_getmanager.png"><img alt="Fetch PostGIS Manager Plugin" class="align-center" src="../../_images/postgis_getmanager.png" style="width: 399.0px; height: 312.0px;" /></a>
<p>В меню <code class="docutils literal"><span class="pre">Модули</span></code> должен появиться  пункт <em>PostGIS Manager</em>.
Для запуска плагина также можно кликнуть по кнопке с логотипом PostGIS (слон с земным шаром), расположенной на панели.</p>
<p>После этого будет уставновлено соединение с базой данных <em>Natural Earth</em>. Оставьте поле пароль пустым, если будет необходимо его ввести.
Вы увидите основное окно управления: слева вы сможете выбрать таблицы из базы данных, в правой части&nbsp;— узнать информацию о них.
Вкладка <em>Просмотр</em> покажет небольшую карту.
Для примера был выбран слой &#8220;Населённые пункты&#8221;, карта была приближена к произвольному месту.</p>
<a class="reference internal image-reference" href="../../_images/postgis_managerpreview.png"><img alt="PostGIS Manager Preview" class="align-center" src="../../_images/postgis_managerpreview.png" style="width: 407.0px; height: 285.5px;" /></a>
<dl class="docutils">
<dt>Далее <em>PostGIS Manager</em> будет использован для импорта шейп-файла в базу данных.</dt>
<dd>Мы используем данным о синдроме внезапной смерти у детей в Северной Каролине,
которые входят в одно из дополнений статистического пакета R.</dd>
</dl>
<p>Из меню <code class="docutils literal"><span class="pre">Data</span></code> выберите опцию <code class="docutils literal"><span class="pre">Load</span> <span class="pre">data</span> <span class="pre">from</span> <span class="pre">shapefile</span></code>.  Нажмите кнопку
<code class="docutils literal"><span class="pre">...</span></code> и загрузите шейп-файл <code class="docutils literal"><span class="pre">sids.shp</span></code> в пакет R <code class="docutils literal"><span class="pre">maptools</span></code> (находится здесь: /usr/local/lib/R/site-library/):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">image</span><span class="p">::</span> <span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">screenshots</span><span class="o">/</span><span class="mi">1024</span><span class="n">x768</span><span class="o">/</span><span class="n">postgis_browsedata</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">scale:</th><td class="field-body">50 %</td>
</tr>
<tr class="field-even field"><th class="field-name">alt:</th><td class="field-body">Find the shapefile</td>
</tr>
<tr class="field-odd field"><th class="field-name">align:</th><td class="field-body">center</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Не изменяя настроек в появившемся окне, нажмите  <code class="docutils literal"><span class="pre">Load</span></code>:</p>
<a class="reference internal image-reference" href="../../_images/postgis_importsids.png"><img alt="Import a shapefile" class="align-center" src="../../_images/postgis_importsids.png" style="width: 217.0px; height: 320.0px;" /></a>
<p>Шейп-файл должен быть импортирован в PostGIS без ошибок. Закройте менеджер PostGIS и вернитесь в основное окно QGIS.</p>
<p>Подгрузите данные SIDS с помощью опции &#8220;Добавить слой PostGIS&#8221;.
Изменив порядок слоёв и заливок, вы сможете создать фоновую картограмму (хороплет),
отображающую количество детей, умерших от синдрома внезапной смерти в Северной Каролине.</p>
<a class="reference internal image-reference" href="../../_images/postgis_sidsmap.png"><img alt="SIDS data mapped" class="align-center" src="../../_images/postgis_sidsmap.png" style="width: 512.0px; height: 371.5px;" /></a>
</div>
<div class="section" id="pgadmin-iii">
<h2><a class="toc-backref" href="#id18">Знакомство с pgAdmin III</a><a class="headerlink" href="#pgadmin-iii" title="Permalink to this headline">¶</a></h2>
<p>Вы можете использовать графический клиент базы данных <code class="docutils literal"><span class="pre">pgAdmin</span> <span class="pre">III</span></code> из системного меню &#8220;Базы данных&#8221;,
чтобы сделать запрос или изменить атрибутивную информацию в базе данных.
Это официальный клиент для PostgreSQL, позволяющий использовать SQL для управления таблицами данных.</p>
<a class="reference internal image-reference" href="../../_images/postgis_pgadmin_main_window.png"><img alt="pgAdmin III" class="align-center" src="../../_images/postgis_pgadmin_main_window.png" style="width: 511.0px; height: 370.5px;" /></a>
<p>В клиенте имеется опция создания нового соединения с сервером PostgreSQL или
подключения с имеющимся соединением. В этом случае необходимо подключиться к
локальному серверу (<code class="docutils literal"><span class="pre">local</span></code>).</p>
<p>После того, как соединение установлено, вы можете видеть список имеющихся баз
данных.</p>
<a class="reference internal image-reference" href="../../_images/postgis_adminscreen0.png"><img alt="pgAdmin III" class="align-center" src="../../_images/postgis_adminscreen0.png" style="width: 512.5px; height: 371.0px;" /></a>
<p>Красный значок &#8220;Х&#8221; на большей части баз данных указывает, что они до сих пор не
подключены (кроме базы данных по умолчанию — <code class="docutils literal"><span class="pre">postgres</span></code>). Таким образом, можно
видеть только базы данных, имеющиеся в системе. Чтобы подключиться, кликните
дважды на имени базы данных. Сделайте это для базы данных <em>natural_earth2</em>.
Теперь вы можете видеть, что красный значок &#8220;Х&#8221; исчез и появился знак &#8220;+&#8221;
слева. Нажатием на дерево раскрывается содержимое базы данных.</p>
<p>Перейдите в подраздел <code class="docutils literal"><span class="pre">schemas</span></code>, раскройте его. После этого раскройте схему
<code class="docutils literal"><span class="pre">public</span></code>. Перемещаясь по структуре и раскрывая пункты (<code class="docutils literal"><span class="pre">Tables</span></code>), вы можете видеть все таблицы, которые содержит эта схема.</p>
<a class="reference internal image-reference" href="../../_images/postgis_adminscreen1.png"><img alt="pgAdmin III" class="align-center" src="../../_images/postgis_adminscreen1.png" style="width: 512.0px; height: 371.5px;" /></a>
</div>
<div class="section" id="sql-pgadmin-iii">
<h2><a class="toc-backref" href="#id19">Выполнение SQL-запроса из pgAdmin III</a><a class="headerlink" href="#sql-pgadmin-iii" title="Permalink to this headline">¶</a></h2>
<p>pgAdmin III имеет возможность выполнения запросов к реляционным базам данных.
Чтобы выполнить запрос, нажмите кнопку <code class="docutils literal"><span class="pre">SQL</span></code> на главной панели инструментов (с
жёлтой лупой).</p>
<p>Мы собираемся найти уровень синдрома внезапной детской смерти (SIDS) в 1974 году
для каждого города. Кроме того, мы будем сортировать результат, основываясь на
вычисленной величине. Чтобы сделать это, нам нужно выполнить следующий запрос
(вставьте его в текстовый редактор в окно SQL):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">name</span><span class="p">,</span> <span class="mi">1000</span><span class="o">*</span><span class="n">sid74</span><span class="o">/</span><span class="n">bir74</span> <span class="k">as</span> <span class="n">rate</span> <span class="kn">from</span> <span class="nn">sids</span> <span class="n">order</span> <span class="n">by</span> <span class="n">rate</span><span class="o">.</span>
</pre></div>
</div>
<p>После этого нажмите на зелёную кнопку со стрелкой, указывающей вправо
(«выполнить запрос»).</p>
<a class="reference internal image-reference" href="../../_images/postgis_adminscreen2.png"><img alt="pgAdmin III" class="align-center" src="../../_images/postgis_adminscreen2.png" style="width: 512.0px; height: 371.5px;" /></a>
</div>
<div class="section" id="id8">
<h2><a class="toc-backref" href="#id20">Что стоит попробовать</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>Несколько дополнительных задач, которые нужно выполнить:</p>
<ol class="arabic simple">
<li>Попробуйте больше пространственных функций, например, <code class="docutils literal"><span class="pre">st_buffer(the_geom)</span></code>, <code class="docutils literal"><span class="pre">st_transform(the_geom,25831)</span></code>, <code class="docutils literal"><span class="pre">x(the_geom)</span></code> — вы найдёте полную документацию здесь: <a class="reference external" href="http://postgis.net/documentation/">http://postgis.net/documentation/</a></li>
<li>Экспортируйте ваши таблицы в шейп-файлы, используя  <code class="docutils literal"><span class="pre">pgsql2shp</span></code> в командной строке.</li>
<li>Попробуйте утилиту <code class="docutils literal"><span class="pre">ogr2ogr</span></code> для экспорта/импорта данных.</li>
</ol>
</div>
<div class="section" id="id9">
<h2><a class="toc-backref" href="#id21">Что дальше?</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>Это только первые шаги на пути использования PostGIS. Существует гораздо больше
полезных функций, которые вы при желании можете попробовать.</p>
<p>Веб-страница PostGIS — <a class="reference external" href="http://postgis.net">http://postgis.net</a></p>
<p>Документация PostGIS — <a class="reference external" href="http://postgis.net/documentation/">http://postgis.net/documentation/</a></p>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
	<font size="-2">
		<div id="translations">
		<!--
			<a href="../../en/index.html">English</a> |
			<a href="../../es/index.html">Español</a> |
			<a href="../../ca/index.html">Català</a> |
			<a href="../../fr/index.html">Français</a> |
			<a href="../../de/index.html">Deutsch</a> |
			<a href="../../it/index.html">Italiano</a> |
			<a href="../../pl/index.html">Polski</a> |
			<a href="../../el/index.html">Ελληνικά</a> |
			<a href="../../ru/index.html">Русский</a> |
			<a href="../../zh/index.html">中文</a> |
			<a href="../../id/index.html">Bahasa Indonesia</a> |
			<a href="../../ko/index.html">한국어</a> |
			<a href="../../ja/index.html">日本語</a>
		-->
		<!-- geo-order: West to East, UK to Japan -->
			<a href="javascript:defaultRedirect('en')">English</a> |
<!--			<a href="javascript:defaultRedirect('pt')">Portugus</a> | -->
			<a href="javascript:defaultRedirect('es')">Español</a> |
			<a href="javascript:defaultRedirect('ca')">Català</a> |
			<a href="javascript:defaultRedirect('fr')">Français</a> |
			<a href="javascript:defaultRedirect('de')">Deutsch</a> |
			<a href="javascript:defaultRedirect('it')">Italiano</a> |
			<a href="javascript:defaultRedirect('pl')">Polski</a> |
			<a href="javascript:defaultRedirect('el')">Ελληνικά</a> |
			<a href="javascript:defaultRedirect('ru')">Русский</a> |
			<a href="javascript:defaultRedirect('zh')">中文</a> |
<!--			<a href="javascript:defaultRedirect('id')">Bahasa Indonesia</a> | -->
			<a href="javascript:defaultRedirect('ko')">한국어</a> |
			<a href="javascript:defaultRedirect('ja')">日本語</a>
		</div>
	</font>
    </div>

<span style="font-size:85%;"><i><a href="../copyright.html">Copyright & Disclaimer</a></i></span>

  </body>
</html>